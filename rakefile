require "rubygems"
require "flickraw"

task "flickraw-cached.rb" do |t|
  open(t.name, "w") {|f|
    f.puts %{FlickRawOptions = {} if not Object.const_defined? :FlickRawOptions}
    f.puts %{FlickRawOptions['lazyload'] = true}
    f.puts %{require 'flickraw'}
    f.puts %{FlickRaw::VERSION << '.#{Time.now.strftime("%Y%m%d")}-cached'} 
    f.puts 'ms = %w{' + flickr.reflection.getMethods.to_a.join(' ') + '}'
    f.puts %{FlickRaw::Flickr.build(ms)}
  }
end

desc "Create cached gemspec file"
spec = Gem::Specification.new do |s|
  s.name = 'flickraw-cached'
  s.summary = "Cached version of Flickraw"
  s.author = "Mael Clerambault"
  s.email =  "maelclerambault@yahoo.fr"
  s.homepage = "http://hanklords.github.com/flickraw/"
  s.version = Time.now.strftime("%Y%m%d")
  s.files = ["flickraw-cached.rb"]
  s.require_path = '.'
  s.add_dependency 'flickraw'
end

task "gemspec" => ["flickraw-cached.rb"] do
  open("flickraw-cached.gemspec", "w") {|f| f.puts spec.to_ruby }
end

